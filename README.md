# 📊 AstrBot Plugin - ChatMaster (活跃度监控大师)

> **专为 AstrBot 设计的群聊活跃度监控与潜水日报插件**
> 拒绝无效社交，精准捕捉“失踪人口”。支持白名单机制、每日定时播报、手动即时检测。

---

## ✨ 功能特性 (Features)

* **🕒 每日定时日报**：每天指定时间（如 10:00）自动检测并推送群内活跃情况。
* **📋 白名单精准监控**：**仅监控配置了昵称的用户**。未配置的路人甲不会干扰视线，无需担心刷屏。
* **🎮 手动即时检测**：支持指令 `/聊天检测`，随时查看当前监控名单内的活跃状态。
* **📝 高度自定义**：
* 自定义判定“潜水”的天数阈值（如 1 天、0.5 天）。
* 自定义播报文案模板。
* 自定义每日推送时间。


* **🛡️ 智能防打扰**：如果全员活跃（无人超时），通过控制台日志反馈，不会在群内发送垃圾信息。
* **💾 数据持久化**：机器人重启后，之前的活跃时间记录不会丢失。

---

## 🚀 安装步骤 (Installation)

1. 打开 AstrBot 的插件目录：`data/plugins/`。
2. 新建文件夹：`astrbot_plugin_chatmaster`。
3. 确保文件夹内包含以下 4 个文件（代码见上文）：
* `main.py` (核心代码)
* `_conf_schema.json` (配置文件)
* `metadata.yaml` (插件信息)
* `requirements.txt` (留空即可)


4. 重启 AstrBot。

---

## ⚙️ 配置说明 (Configuration)

在 AstrBot 管理后台 -> **插件** -> **ChatMaster** -> **配置** 中进行设置。

| 配置项 | 说明 | 示例 / 默认值 |
| --- | --- | --- |
| **需要监控的群聊ID列表** | 只有填入此列表的群才会生效。 | `12345678`, `88888888` |
| **每日自动播报时间** | 24小时制，每天定时检查的时间。 | `09:00` (早上9点) |
| **潜水判定阈值 (天)** | 超过多少天没说话才会被自动点名。 | `1.0` (1天) |
| **自动播报模板** | 自定义消息格式。可用变量：`{nickname}`(昵称), `{days}`(天数), `{last_seen}`(时间) | `"“{nickname}”已经“{days}”天没发言了"` |
| **昵称设置列表 (白名单)** | **关键设置**：只有在这里添加了的用户才会被监控。格式为 `QQ:昵称`。 | `123456:张三` <br>

<br> `654321:李四` |

> **⚠️ 注意**：插件采用**白名单机制**。你必须在“昵称设置列表”中添加了该用户的 QQ 和昵称，插件才会记录和统计他的发言。未添加的用户将被忽略。

---

## 📖 使用指南 (Usage)

### 1. 初始化数据

插件安装后，只有当**白名单内的用户**发过言，机器人才能记录下他的“起始时间”。

* 建议安装后，让大家在群里冒个泡。
* 或者等待大家自然发言，数据会自动积累。

### 2. 手动检测指令

在群内发送以下指令，可立即查看当前的统计结果：

```text
/聊天检测

```

**效果演示：**

> 📊 群 (808438666) 活跃度数据概览：
> 🟢 麻花 | 未发言: 0天 | 最后: 2026-01-22 10:56:20
> 🟢 Chaolf | 未发言: 0天 | 最后: 2026-01-21 19:11:48
> 🔴 徐天明 | 未发言: 3天 | 最后: 2026-01-19 09:00:00
> 共记录 3 人（仅统计白名单用户）。

### 3. 每日自动日报

当到达设定的 `push_time` 时：

* **如果有潜水员**（未发言时间 > `timeout_days`）：群内自动发送日报。
* **如果全员活跃**：群内**不发送消息**，控制台会打印日志：`ChatMaster: -> 结果: 无需推送 (检测了 X 个白名单用户，均活跃)。`

---

## ❓ 常见问题 (FAQ)

**Q: 为什么 `/聊天检测` 显示的人数很少？**
A: 请检查两点：

1. 该用户是否已添加到**“昵称设置列表”**？（不在列表里的用户会被忽略）
2. 该用户在插件安装后是否**发过言**？（如果从未发言，机器人没有他的时间记录，暂时无法显示）

**Q: 我设置了时间，为什么没推送？**
A: 可能是因为所有人都很活跃，没达到你设置的“潜水天数”阈值。你可以查看 AstrBot 的后台控制台日志，搜索 `ChatMaster` 关键词查看运行记录。

---

## 📝 更新日志

* **v1.2.5**: 优化控制台日志输出，增加“无需推送”的明确提示；修复网络报错干扰问题。
* **v1.2.4**: 引入白名单机制，仅统计配置表中的用户；过滤路人数据。
* **v1.2.0**: 初始版本，支持基本的时间记录和手动查询。

---

**Enjoy your community! 🎈**
